{% extends "admin/base.html" %} {% block title %}Contacts{% endblock %} {% block page_title %}Contact Messages{% endblock %} {% block page_subtitle %}Manage and respond to contact form submissions{% endblock %} {% block content %}
<div class="admin-content">
    <!-- Stats Cards -->
    <div class="admin-stats">
        <div class="stat-card">
            <span class="stat-number">{{ contacts|length }}</span>
            <span class="stat-label">Total Messages</span>
        </div>
    </div>

    <!-- Filters -->
    <div class="admin-filters">
        <form method="GET" class="filter-form">
            <input type="text" name="search" placeholder="Search by name or email..." value="{{ request.args.get('search', '') }}">
            <button type="submit" class="btn btn-primary">Search</button>
            <a href="/admin/contacts" class="btn btn-secondary">Clear</a>
        </form>
    </div>

    <!-- Contacts Table -->
    <div class="admin-table-container">
        {% if contacts %}
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Message</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for contact in contacts %}
                <tr>
                    <td>{{ contact.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>
                        <div class="contact-name">
                            <strong>{{ contact.name }}</strong>
                        </div>
                    </td>
                    <td>
                        <a href="mailto:{{ contact.email }}">{{ contact.email }}</a>
                    </td>
                    <td>
                        {% if contact.phone %}
                        <a href="tel:{{ contact.phone }}">{{ contact.phone }}</a> {% else %}
                        <span class="text-muted">-</span> {% endif %}
                    </td>
                    <td>
                        <div class="message-preview" title="{{ contact.message }}">
                            {{ contact.message[:100] }}{% if contact.message|length > 100 %}...{% endif %}
                        </div>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-primary" onclick="showReplyModal({{ contact.id }}, '{{ contact.name|escapejs }}', '{{ contact.email }}')">
                                Reply
                            </button>
                            <form method="POST" action="/admin/contacts/{{ contact.id }}/delete" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this message?');">
                                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <svg class="icon" viewBox="0 0 24 24" fill="none" style="width: 48px; height: 48px; margin-bottom: 16px;">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="1.8"/>
            </svg>
            <h3>No Contact Messages</h3>
            <p>When visitors submit the contact form, their messages will appear here.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Reply Modal -->
<div id="replyModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Reply to {{ contact.name if contact else 'Visitor' }}</h2>
            <button class="modal-close" onclick="closeReplyModal()">&times;</button>
        </div>
        <form id="replyForm" method="POST" action="/admin/contacts/reply">
            <input type="hidden" id="contactId" name="contact_id">
            <div class="modal-body">
                <div class="form-group">
                    <label for="replyTo">To:</label>
                    <input type="email" id="replyTo" name="email" readonly>
                </div>
                <div class="form-group">
                    <label for="replySubject">Subject:</label>
                    <input type="text" id="replySubject" name="subject" value="Re: Your inquiry - Nirvana Buddha Meditation Center" required>
                </div>
                <div class="form-group">
                    <label for="replyMessage">Message:</label>
                    <textarea id="replyMessage" name="message" rows="6" required placeholder="Type your response here..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeReplyModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Send Reply</button>
            </div>
        </form>
    </div>
</div>

<style>
    .contact-name {
        font-weight: 500;
    }
    
    .message-preview {
        max-width: 250px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-size: 0.9em;
        color: #666;
    }
    
    .action-buttons {
        display: flex;
        gap: 8px;
    }
    
    .admin-filters {
        margin-bottom: 20px;
    }
    
    .filter-form {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .filter-form input {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        min-width: 250px;
    }
    
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }
    
    .modal-content {
        background-color: #fff;
        margin: 5% auto;
        padding: 0;
        border-radius: 8px;
        width: 90%;
        max-width: 600px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #eee;
    }
    
    .modal-header h2 {
        margin: 0;
        font-size: 1.25rem;
    }
    
    .modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #999;
    }
    
    .modal-close:hover {
        color: #333;
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .form-group {
        margin-bottom: 16px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 6px;
        font-weight: 500;
        color: #333;
    }
    
    .form-group input,
    .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }
    
    .form-group textarea {
        resize: vertical;
        min-height: 120px;
    }
    
    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        padding: 20px;
        border-top: 1px solid #eee;
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }
    
    .empty-state h3 {
        margin-bottom: 8px;
        color: #333;
    }
</style>

<script>
    function showReplyModal(contactId, name, email) {
        document.getElementById('contactId').value = contactId;
        document.getElementById('replyTo').value = email;
        document.getElementById('replySubject').value = 'Re: Your inquiry - Nirvana Buddha Meditation Center';
        document.getElementById('replyMessage').value = '';
        document.getElementById('replyModal').style.display = 'block';
    }

    function closeReplyModal() {
        document.getElementById('replyModal').style.display = 'none';
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
        var modal = document.getElementById('replyModal');
        if (event.target == modal) {
            closeReplyModal();
        }
    }
</script>
{% endblock %}